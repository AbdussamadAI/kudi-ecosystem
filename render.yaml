services:
  - type: web
    name: kudi-backend
    runtime: docker
    rootDir: backend
    dockerfilePath: Dockerfile
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: OPENROUTER_API_KEY
        sync: false
      - key: LLM_PROVIDER
        value: openrouter
      - key: LLM_MODEL
        value: meta-llama/llama-3.1-70b-instruct
      - key: REDIS_URL
        fromService:
          name: kudi-redis
          type: redis
          property: connectionString
    healthCheckPath: /health

  - type: web
    name: kudi-frontend
    runtime: docker
    rootDir: frontend
    dockerfilePath: Dockerfile
    envVars:
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false
      - key: NEXT_PUBLIC_API_URL
        value: https://kudi-backend.onrender.com/api/v1

  - type: redis
    name: kudi-redis
    ipAllowList: []
